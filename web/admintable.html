<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>联合数据电话销售系统</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!-- basic styles -->

    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>

    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css"/>
    <![endif]-->

    <!-- page specific plugin styles -->
    <script src="assets/js/jquery-2.0.3.min.js"></script>
    <script src="assets/bootstrap-table.js"></script>

    <link rel="stylesheet" href="assets/css/jquery-ui-1.10.3.custom.min.css"/>
    <link rel="stylesheet" href="assets/css/chosen.css"/>
    <link rel="stylesheet" href="assets/css/datepicker.css"/>
    <link rel="stylesheet" href="assets/css/bootstrap-timepicker.css"/>
    <link rel="stylesheet" href="assets/css/daterangepicker.css"/>
    <link rel="stylesheet" href="assets/css/colorpicker.css"/>
    <link rel="stylesheet" href="assets/bootstrap-table.css"/>

    <!-- fonts -->

    <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300"/>-->

    <!-- ace styles -->

    <link rel="stylesheet" href="assets/css/ace.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-skins.min.css"/>

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
    <![endif]-->
    <!-- basic scripts -->

    <!--[if !IE]> -->

    <script src="assets/js/jquery-2.0.3.min.js"></script>

    <!-- <![endif]-->

    <!--[if IE]>
    <script src="assets/js/jquery-1.10.2.min.js"></script>
    <![endif]-->

    <!--[if !IE]> -->

    <script type="text/javascript">
        window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
    </script>

    <!-- <![endif]-->

    <!--[if IE]>
    <script type="text/javascript">
        window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>" + "<" + "/script>");
    </script>
    <![endif]-->

    <script type="text/javascript">
        if ("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/typeahead-bs2.min.js"></script>

    <!-- page specific plugin scripts -->

    <!--[if lte IE 8]>
    <script src="assets/js/excanvas.min.js"></script>
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->

    <script src="assets/js/ace-extra.min.js"></script>
    <script src="assets/bootstrap-table.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="navbar navbar-default" id="navbar">
    <script type="text/javascript">
        try {
            ace.settings.check('navbar', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="navbar-container" id="navbar-container">
        <div class="navbar-header pull-left">
            <a href="#" class="navbar-brand">
                <small>
                    <i class="icon-leaf"></i>
                    联合数据电话销售系统管理员页面
                </small>
            </a><!-- /.brand -->
        </div><!-- /.navbar-header -->

        <div class="navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">
                <li class="light-blue">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo"/>
                        <span class="user-info">
									<small>Welcome,</small>
									Jason
								</span>

                        <i class="icon-caret-down"></i>
                    </a>

                    <ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li>
                            <a href="#">
                                <i class="icon-cog"></i>
                                Settings
                            </a>
                        </li>

                        <li>
                            <a href="#">
                                <i class="icon-user"></i>
                                Profile
                            </a>
                        </li>

                        <li class="divider"></li>

                        <li>
                            <a href="/logout">
                                <i class="icon-off"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul><!-- /.ace-nav -->
        </div><!-- /.navbar-header -->
    </div><!-- /.container -->
</div>

<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
            <span class="menu-text"></span>
        </a>

        <div class="sidebar" id="sidebar">
            <script type="text/javascript">
                try {
                    ace.settings.check('sidebar', 'fixed')
                } catch (e) {
                }
            </script>


            <ul class="nav nav-list">
                <li class="active">
                    <a href="#">
                        <i class="icon-dashboard"></i>
                        <span class="menu-text"> 控制台 </span>
                    </a>
                </li>

                <li class="active open">
                    <a href="tables.html" class="dropdown-toggle">
                        <i class="icon-edit"></i>
                        <span class="menu-text"> 用户管理 </span>

                        <b class="arrow icon-angle-down"></b>
                    </a>

                </li>

                <li class="active open">
                    <a href="#" class="dropdown-toggle">
                        <i class="icon-edit"></i>
                        <span class="menu-text"> 历史记录 </span>

                        <b class="arrow icon-angle-down"></b>
                    </a>

                    <ul class="submenu">
                        <li class="active">
                            <a href="admintable.html">
                                <i class="icon-double-angle-right"></i>
                                历史记录清单
                            </a>
                        </li>
                        <!--<li class="active">-->
                            <!--<a href="no_answer_list.html">-->
                                <!--<i class="icon-double-angle-right"></i>-->
                                <!--电话无人接听的客户-->
                            <!--</a>-->
                        <!--</li>-->
                        <!--<li class="active">-->
                            <!--<a href="unexpired_insurance_list.html">-->
                                <!--<i class="icon-double-angle-right"></i>-->
                                <!--保险未到期的客户-->
                            <!--</a>-->
                        <!--</li>-->
                    </ul>
                <li class="active">
                    <a href="history.html">
                        <i class="icon-dashboard"></i>
                        <span class="menu-text"> 统计 </span>
                    </a>
                </li>

                </li>


            </ul><!-- /.nav-list -->

            <div class="sidebar-collapse" id="sidebar-collapse">
                <i class="icon-double-angle-left" data-icon1="icon-double-angle-left"
                   data-icon2="icon-double-angle-right"></i>
            </div>

            <script type="text/javascript">
                try {
                    ace.settings.check('sidebar', 'collapsed')
                } catch (e) {
                }
            </script>
        </div>

        <div class="main-content">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch (e) {
                    }
                </script>

                <ul class="breadcrumb">
                    <li>
                        <i class="icon-home home-icon"></i>
                        <a href="#">主页</a>
                    </li>

                    <li>
                        <a href="#">历史记录</a>
                    </li>
                    <li class="active">历史记录清单</li>
                </ul><!-- .breadcrumb -->

            </div>

            <div class="page-content">
                <div class="page-header">
                    <h1>
                        历史记录
                        <small>
                            <i class="icon-double-angle-right"></i>
                            历史记录清单
                        </small>
                    </h1>
                </div><!-- /.page-header -->

                <div class="row">
                    <div class="col-xs-12 col-sm-1"></div>

                    <div class="col-xs-12 col-sm-4">
                        <div id="table0">
                            <table id="sample-table-0"></table>
                        </div>
                        <hr/>
                    </div>
                    <div class="col-xs-12 col-sm-2"></div>

                    <div class="col-xs-12 col-sm-2" style="width:28%;">
                        <table id="sample-table-1"></table>
                        <script type="text/javascript">
                            $('#sample-table-1').bootstrapTable({
                                url: '/getAllCustomerList',
                                pagination: true,           //---Add pagination---lzr
                                pageSize: 10,
                                classes: 'table table-striped table-bordered table-hover',
                                columns: [{
                                    field: 'customerId',
                                    title: '客户ID',
                                    width: '64%'
                                }, {
                                    field: 'status',
                                    title: '状态',
                                    width: '64%'
                                }],
                                onClickRow: function (row, element) {   //---Add parameters 'element', represents tr element---lzr
                                    $('#table0').empty();
                                    var box = document.getElementById("table0");
                                    var table0 = document.createElement("table");
                                    table0.setAttribute("id", "sample-table-0");
                                    box.appendChild(table0);

                                    //---HighLight active row---lzr
                                    $("#sample-table-1 tr td").removeAttr("id");
                                    $(element).children("td").attr("id","table-row-highlight");

                                    //---Call the generateCustomerInfoTable(id) function---lzr
                                    generateCustomerInfoTable(row.customerId);

                                    //---Check whether has next row
                                    var tableData = $('#sample-table-1').bootstrapTable('getData');
                                    var lastCustomerId = tableData[tableData.length-1].customerId
                                    var hasNext = row.customerId == lastCustomerId ? false : true;
                                    generateFeedbackInfoTable(row.customerId, hasNext);
                                },
                                onLoadSuccess: function () {
                                    //用获取table(通过其id ) 获取指定的行，列
                                    var id = document.getElementById("sample-table-1").rows[1].cells[0].innerHTML;

                                    //---Highlight first row---lzr
                                    $("#sample-table-1 tr[data-index='0'] td").attr("id","table-row-highlight");

                                    console.log(id + "------");

                                    //---Call the generateCustomerInfoTable(id) function---lzr
                                    generateCustomerInfoTable(id);
                                },
                                onPageChange: function(number){     //---Fires when change page number---lzr
                                    //---Hightlight the first row of table---lzr
                                    $("#sample-table-1").find("tr").eq(1).children("td").attr("id","table-row-highlight");

                                    //---Refresh #sample-table-0 contents
                                    $('#table0').empty();
                                    var box = document.getElementById("table0");
                                    var table0 = document.createElement("table");
                                    table0.setAttribute("id", "sample-table-0");
                                    box.appendChild(table0);

                                    //用获取table(通过其id ) 获取指定的行，列
                                    var id = document.getElementById("sample-table-1").rows[1].cells[0].innerHTML;

                                    //---Call the generateCustomerInfoTable(id) function---lzr
                                    generateCustomerInfoTable(id);
                                }
                            });

                            //---Generate customer info table---lzr
                            function generateCustomerInfoTable(id) {
                                $('#sample-table-0').bootstrapTable({
                                    url: '/getOneCustomer?id=' + id,
                                    columns: [{
                                        field: 'customerId',
                                        title: '客户ID'
                                    }, {
                                        field: 'customerPhone',
                                        title: '电话号码'
                                    }, {
                                        field: 'gender',
                                        title: '性别'
                                    }, {
                                        field: 'age',
                                        title: '年龄'
                                    }, {
                                        field: 'model',
                                        title: '车型'
                                    }, {
                                        field: 'value',
                                        title: '客户价值'
                                    }, {
                                        field: 'status',
                                        title: '状态'
                                    }]
                                });
                                $('#sample-table-0').bootstrapTable('toggleView');
                            }

                            //---Generate feedback info---lzr
                            function generateFeedbackInfoTable(id, hasNext){
                                //---Ajax get feedback info---lzr
                                $.ajax({
                                    url: "/getFeedbackByCustomerId?id=" + id ,    //---Change this url---lzr
                                    method: 'GET',
                                    dataType: 'json',
                                    success: function (feedbackJason) {
                                        //清空表单
                                        $('#form1')[0].reset();

                                        var json = eval(feedbackJason);//---Object List---lzr
                                        //---Set form values---lzr
                                        if(json[0].status == 1){    //---Customer agrees to purchase insurance---lzr
                                            //---Check the radio button---lzr
                                            $(".radio input[value='one']").attr("checked","checked");
                                            //---Fill in the remark box---lzr
                                            $("#remark").text(json[0].remark);
                                        }
                                        else if(json[0].status == 2){
                                            //---Check the radio button---lzr
                                            $(".radio input[value='two']").attr("checked","checked");
                                            //---Check the failure reason---lzr
                                            $("#failReason").find("option[name= "+ json[0].fail_reason_type + "]").attr("selected", true);
                                            //---Check last_purchasedate---lzr
                                            $("#lastdate").val(json[0].last_purchasedate);
                                            //---Fill in the remark box---lzr
                                            $("#remark").text(json[0].remark);
                                        }else if(json[0].status == 3){
                                            //---Check the radio button---lzr
                                            $(".radio input[value='three']").attr("checked","checked");
                                            //---Check the failure reason---lzr
                                            $("#failReason").find("option[name= "+ json[0].fail_reason_type + "]").attr("selected", true);
                                            //---Check last_purchasedate---lzr
                                            $("#lastdate").val(json[0].last_purchasedate);
                                            //---Fill in the remark box---lzr
                                            $("#remark").text(json[0].remark);
                                        }
                                        //---Check whether the last line of data---lzr
                                        var submitBtn = $(".col-md-offset-2 button[value='submit']");
                                        if(hasNext){
                                            //---Disable the button
                                            submitBtn.disable();
                                            //---hover
                                            submitBtn.hover(function(){
                                                $(this).popover({
                                                    title: "提示",
                                                    content: "当前已是最后一个用户",
                                                    placement: 'top'
                                                })
                                            })

                                        }else{
                                            submitBtn.removeAttr("disable");
                                            submitBtn.unbind("hover");
                                        }

                                    }
                                });
                            }


                            $(document).ready(function () {

                            });
                            //                            var td1 = document.getElementById("sample-table-1").innerHTML;


                        </script>
                    </div>
                </div><!-- /.row -->


            </div>
        </div><!-- /.main-content -->


    </div>
</div><!-- /#ace-settings-container -->
</div><!-- /.main-container-inner -->

<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
    <i class="icon-double-angle-up icon-only bigger-110"></i>
</a>
</div><!-- /.main-container -->


<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/chosen.jquery.min.js"></script>
<!--<script src="assets/js/fuelux/fuelux.spinner.min.js"></script>-->
<script src="assets/js/date-time/bootstrap-datepicker.min.js"></script>
<script src="assets/js/date-time/bootstrap-timepicker.min.js"></script>
<script src="assets/js/date-time/moment.min.js"></script>
<script src="assets/js/date-time/daterangepicker.min.js"></script>
<script src="assets/js/bootstrap-colorpicker.min.js"></script>
<script src="assets/js/jquery.knob.min.js"></script>
<script src="assets/js/jquery.autosize.min.js"></script>
<script src="assets/js/jquery.inputlimiter.1.3.1.min.js"></script>
<script src="assets/js/jquery.maskedinput.min.js"></script>
<script src="assets/js/bootstrap-tag.min.js"></script>

<!-- ace scripts -->

<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>

<!-- inline scripts related to this page -->

<script type="text/javascript">
    jQuery(function ($) {
        $(".chosen-select").chosen();
        $('#chosen-multiple-style').on('click', function (e) {
            var target = $(e.target).find('input[type=radio]');
            var which = parseInt(target.val());
            if (which == 2) $('#form-field-select-4').addClass('tag-input-style');
            else $('#form-field-select-4').removeClass('tag-input-style');
        });


        $('[data-rel=tooltip]').tooltip({container: 'body'});
        $('[data-rel=popover]').popover({container: 'body'});

        $('textarea[class*=autosize]').autosize({append: "\n"});
        $('textarea.limited').inputlimiter({
            remText: '%n character%s remaining...',
            limitText: 'max allowed : %n.'
        });

        $.mask.definitions['~'] = '[+-]';
        $('.input-mask-date').mask('99/99/9999');
        $('.input-mask-phone').mask('(999) 999-9999');
        $('.input-mask-eyescript').mask('~9.99 ~9.99 999');
        $(".input-mask-product").mask("a*-999-a999", {
            placeholder: " ", completed: function () {
                alert("You typed the following: " + this.val());
            }
        });
















        $('.date-picker').datepicker({autoclose: true}).next().on(ace.click_event, function () {
            $(this).prev().focus();
        });
        $('input[name=date-range-picker]').daterangepicker().prev().on(ace.click_event, function () {
            $(this).next().focus();
        });

        $('#colorpicker1').colorpicker();
        $('#simple-colorpicker-1').ace_colorpicker();


        $(".knob").knob();


        //we could just set the data-provide="tag" of the element inside HTML, but IE8 fails!
        var tag_input = $('#form-field-tags');
        if (!( /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase()))) {
            tag_input.tag(
                {
                    placeholder: tag_input.attr('placeholder'),
                    //enable typeahead by specifying the source array
                    source: ace.variable_US_STATES,//defined in ace.js >> ace.enable_search_ahead
                }
            );
        }
        else {
            //display a textarea for old IE, because it doesn't support this plugin or another one I tried!
            tag_input.after('<textarea id="' + tag_input.attr('id') + '" name="' + tag_input.attr('name') + '" rows="3">' + tag_input.val() + '</textarea>').remove();
            //$('#form-field-tags').autosize({append: "\n"});
        }


        /////////
        $('#modal-form input[type=file]').ace_file_input({
            style: 'well',
            btn_choose: 'Drop files here or click to choose',
            btn_change: null,
            no_icon: 'icon-cloud-upload',
            droppable: true,
            thumbnail: 'large'
        })

        //chosen plugin inside a modal will have a zero width because the select element is originally hidden
        //and its width cannot be determined.
        //so we set the width after modal is show
        $('#modal-form').on('shown.bs.modal', function () {
            $(this).find('.chosen-container').each(function () {
                $(this).find('a:first-child').css('width', '210px');
                $(this).find('.chosen-drop').css('width', '210px');
                $(this).find('.chosen-search input').css('width', '200px');
            });
        })
        /**
         //or you can activate the chosen plugin after modal is shown
         //this way select element becomes visible with dimensions and chosen works as expected
         $('#modal-form').on('shown', function () {
					$(this).find('.modal-chosen').chosen();
				})
         */

    });
</script>
<!--<div style="display:none">-->
    <!--<script src='http://v7.cnzz.com/stat.php?id=155540&web_id=155540' language='JavaScript' charset='gb2312'></script>-->
<!--</div>-->
</body>
</html>
